<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colin's Personal Space</title>

    <head>
  <!-- ... other meta tags, title, links, etc. ... -->

  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:
      https://cdnjs.cloudflare.com
      https://cdn.jsdelivr.net
      https://code.jquery.com
      https://unpkg.com
      https://d3js.org
      https://threejs.org
      https://cdn.plot.ly
      https://stackpath.bootstrapcdn.com
      https://maps.googleapis.com
      https://cdn.tailwindcss.com
      https://ajax.googleapis.com
      https://kit.fontawesome.com
      https://cdn.datatables.net
      https://maxcdn.bootstrapcdn.com
      https://code.highcharts.com
      https://tako-static-assets-production.s3.amazonaws.com
      https://www.youtube.com
      https://fonts.googleapis.com
      https://fonts.gstatic.com
      https://pfst.cf2.poecdn.net
      https://puc.poecdn.net
      https://i.imgur.com
      https://wikimedia.org
      https://*.icons8.com
      https://*.giphy.com
      https://picsum.photos
      https://images.unsplash.com
      https://github.com
      https://raw.githubusercontent.com
      https://objects.githubusercontent.com
      https://*.githubusercontent.com
      https://audio.lifeofcy.cc;

    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://static.cloudflareinsights.com;

    connect-src 'self' https://cloudflareinsights.com;

    /* You can keep or add other directives like style-src, img-src, font-src, media-src as needed */
  ">
</head>
    <style>
        /* [此处建议粘贴您原有的 CSS 样式] */
        /* 以下为音频交互必需的关键样式补充 */
        .music-item .pause-icon { display: none; }
        .music-item.playing .play-icon { display: none !important; }
        .music-item.playing .pause-icon { display: block !important; }
        
        #logoBtn.playing, .music-item.playing .music-cover {
            animation: rotateForever 6s linear infinite;
        }
        @keyframes rotateForever {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* 避免双击选中文本干扰交互 */
        #logoBtn, .music-item { user-select: none; -webkit-user-select: none; cursor: pointer; }
    </style>
</head>
<body>

    <div id="ai-panel" class="works-panel active">
        <div class="ai-grid">
            <div class="music-item neu-flat" data-audio="https://audio.lifeofcy.cc/audio%20files%20for%20lifeofcy/Blueberry%20Morning%20Bliss.webm">
                <div class="music-cover-container">
                    <img src="https://i.imgur.com/8N4X6uB.jpg" class="music-cover">
                    <div class="music-play-btn">
                        <svg class="play-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                        <svg class="pause-icon" viewBox="0 0 24 24" style="display:none;"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </div>
                </div>
                <div class="music-title">Blueberry Morning Bliss</div>
            </div>

            <div class="music-item neu-flat" data-audio="https://audio.lifeofcy.cc/audio%20files%20for%20lifeofcy/Warm%20Air%20Between%20Notes.webm">
                <div class="music-cover-container">
                    <img src="https://i.imgur.com/mS9hS1y.jpg" class="music-cover">
                    <div class="music-play-btn">
                        <svg class="play-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                        <svg class="pause-icon" viewBox="0 0 24 24" style="display:none;"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </div>
                </div>
                <div class="music-title">Warm Air Between Notes</div>
            </div>

            <div class="music-item neu-flat" data-audio="https://audio.lifeofcy.cc/audio%20files%20for%20lifeofcy/Winter%20Light%20Crossing%20Silence.webm">
                <div class="music-cover-container">
                    <img src="https://i.imgur.com/Y3UqN4H.jpg" class="music-cover">
                    <div class="music-play-btn">
                        <svg class="play-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                        <svg class="pause-icon" viewBox="0 0 24 24" style="display:none;"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </div>
                </div>
                <div class="music-title">Winter Light Crossing Silence</div>
            </div>

            <div class="music-item neu-flat" data-audio="https://audio.lifeofcy.cc/audio%20files%20for%20lifeofcy/Sunlit%20Loops.webm">
                <div class="music-cover-container">
                    <img src="https://i.imgur.com/K6Y7Z8B.jpg" class="music-cover">
                    <div class="music-play-btn">
                        <svg class="play-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                        <svg class="pause-icon" viewBox="0 0 24 24" style="display:none;"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </div>
                </div>
                <div class="music-title">Sunlit Loops</div>
            </div>

            <div class="music-item neu-flat" data-audio="https://audio.lifeofcy.cc/audio%20files%20for%20lifeofcy/Keep%20it%20a%20secret%20(1).webm">
                <div class="music-cover-container">
                    <img src="https://i.imgur.com/5J3P9zR.jpg" class="music-cover">
                    <div class="music-play-btn">
                        <svg class="play-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                        <svg class="pause-icon" viewBox="0 0 24 24" style="display:none;"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </div>
                </div>
                <div class="music-title">Keep it a secret (1)</div>
            </div>

            <div class="music-item neu-flat" data-audio="https://audio.lifeofcy.cc/audio%20files%20for%20lifeofcy/Keep%20it%20a%20secret%20(2).webm">
                <div class="music-cover-container">
                    <img src="https://i.imgur.com/5J3P9zR.jpg" class="music-cover">
                    <div class="music-play-btn">
                        <svg class="play-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                        <svg class="pause-icon" viewBox="0 0 24 24" style="display:none;"><path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    </div>
                </div>
                <div class="music-title">Keep it a secret (2)</div>
            </div>
        </div>
    </div>

    <script>
        // 1. 初始化单例播放器（解决冲突）
        const audioSystem = new Audio();
        audioSystem.crossOrigin = "anonymous";
        let activeEl = null;

        // 2. 状态切换函数（视觉零延迟）
        function updateUI(el, isPlaying) {
            if (!el) return;
            // 切换旋转类
            isPlaying ? el.classList.add('playing') : el.classList.remove('playing');
            // 切换图标显隐
            const play = el.querySelector('.play-icon');
            const pause = el.querySelector('.pause-icon');
            if (play && pause) {
                play.style.display = isPlaying ? 'none' : 'block';
                pause.style.display = isPlaying ? 'block' : 'none';
            }
        }

        // 3. 核心播放控制逻辑
        async function playTrack(url, el) {
            // A. 如果点击的是当前正在播放的项目：执行播放/暂停切换
            if (activeEl === el) {
                if (!audioSystem.paused) {
                    audioSystem.pause();
                    updateUI(el, false);
                } else {
                    updateUI(el, true);
                    audioSystem.play().catch(() => updateUI(el, false));
                }
                return;
            }

            // B. 如果点击的是新项目：先重置旧的，再播新的
            if (activeEl) updateUI(activeEl, false);
            
            activeEl = el;
            updateUI(el, true); // 视觉立即响应！

            try {
                audioSystem.src = url;
                audioSystem.load();
                await audioSystem.play();
            } catch (err) {
                console.error("Audio playback failed:", err);
                updateUI(el, false);
                activeEl = null;
            }
        }

        // 4. 音频播放完毕重置 UI
        audioSystem.onended = () => {
            if (activeEl) updateUI(activeEl, false);
            activeEl = null;
        };

        // 5. 事件绑定
        // LOGO 点击
        const logoBtn = document.getElementById('logoBtn');
        const welcomeVoice = "https://audio.lifeofcy.cc/audio%20files%20for%20lifeofcy/Welcome%20voice.webm";
        if (logoBtn) {
            logoBtn.addEventListener('click', (e) => {
                e.preventDefault();
                playTrack(welcomeVoice, logoBtn);
            });
        }

        // 音乐列表点击
        document.querySelectorAll('.music-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const url = this.getAttribute('data-audio');
                if (url) playTrack(url, this);
            });
        });

        // [此处贴回您原有的导航切换、弹窗、分类切换等逻辑脚本]
    </script>
</body>
</html>


